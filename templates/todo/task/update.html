{% extends 'base/base.html' %}
{% block content %}
<form action="{% url 'todo:task_update' object.pk %}" method="post" novalidate>
  {% csrf_token %}

  {# フォーム全体のエラー（clean()など） #}
  {% if form.non_field_errors %}
    <div class="alert alert-danger mb-3">
      {% for e in form.non_field_errors %}{{ e }}<br>{% endfor %}
    </div>
  {% endif %}

  <div class="row my-sm-4 justify-content-center">
    <label for="{{ form.title.id_for_label }}" class="col-md-2 col-form-label">タイトル</label>
    <div class="col-md-6">
      <input
        type="text"
        name="{{ form.title.name }}"
        id="{{ form.title.id_for_label }}"
        class="form-control{% if form.title.errors %} is-invalid{% endif %}"
        value="{{ form.title.value|default_if_none:'' }}"
        required
      >
      {% for error in form.title.errors %}
        <div class="invalid-feedback">{{ error }}</div>
      {% endfor %}
    </div>
  </div>

  <div class="row my-sm-4 justify-content-center">
    <label for="{{ form.description.id_for_label }}" class="col-md-2 col-form-label">説明</label>
    <div class="col-md-6">
      <textarea
        name="{{ form.description.name }}"
        id="{{ form.description.id_for_label }}"
        class="form-control{% if form.description.errors %} is-invalid{% endif %}"
        rows="4"
      >{{ form.description.value|default_if_none:'' }}</textarea>
      {% for error in form.description.errors %}
        <div class="invalid-feedback">{{ error }}</div>
      {% endfor %}
    </div>
  </div>

  <div class="row my-sm-4 justify-content-center">
    <label for="{{ form.due_date.id_for_label }}" class="col-md-2 col-form-label">期限</label>
    <div class="col-md-6">
      <input
        type="date"
        name="{{ form.due_date.name }}"
        id="{{ form.due_date.id_for_label }}"
        class="form-control{% if form.due_date.errors %} is-invalid{% endif %}"
        value="{{ form.due_date.value|date:'Y-m-d'|default_if_none:'' }}"
      >
      {% for error in form.due_date.errors %}
        <div class="invalid-feedback">{{ error }}</div>
      {% endfor %}
    </div>
  </div>

  <div class="row my-sm-4 justify-content-center">
    <label for="{{ form.priority.id_for_label }}" class="col-md-2 col-form-label">優先度</label>
    <div class="col-md-6">
      <select
        name="{{ form.priority.name }}"
        id="{{ form.priority.id_for_label }}"
        class="form-select{% if form.priority.errors %} is-invalid{% endif %}"
      >
        {% for val, label in form.fields.priority.choices %}
          <option value="{{ val }}"
            {% if form.priority.value|stringformat:"s" == val|stringformat:"s" %}selected{% endif %}>
            {{ label }}
          </option>
        {% endfor %}
      </select>
      {% for error in form.priority.errors %}
        <div class="invalid-feedback">{{ error }}</div>
      {% endfor %}
    </div>
  </div>

  <div class="row my-sm-4 justify-content-center">
    <span class="col-md-2 col-form-label">完了</span>
    <div class="col-md-6">
      <div class="form-check">
        <input
          type="checkbox"
          name="{{ form.completed.name }}"
          id="{{ form.completed.id_for_label }}"
          class="form-check-input{% if form.completed.errors %} is-invalid{% endif %}"
          {% if form.completed.value %}checked{% endif %}
        >
        <label class="form-check-label" for="{{ form.completed.id_for_label }}">完了にする</label>
        {% for error in form.completed.errors %}
          <div class="invalid-feedback d-block">{{ error }}</div>
        {% endfor %}
      </div>
    </div>
  </div>

  <div class="row my-4 px-0 justify-content-center">
    <button type="submit" class="col-md-2 mx-md-1 my-1 btn btn-primary btn-lg">更新</button>
    <a href="{% url 'todo:task_detail' object.pk %}" class="col-md-2 mx-md-1 my-1 btn btn-secondary btn-lg">戻る</a>
  </div>
</form>
{% endblock content %}
